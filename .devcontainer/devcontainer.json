{
    // Use dev stage of Dockerfile for creating the dev container.
    "dockerFile": "../Dockerfile",
    "build": {
        "target": "dev"
    },

    // Match context from build.sh.
    "context": "../container_files/",

    // Bind-mount source into dev container and set workspace.
    "workspaceMount": "type=bind,source=${localWorkspaceFolder}/container_files/main.go,target=/src/main.go",
    "workspaceFolder": "/src/",

    // Could simply mount the src directory, but then we would lose the go.mod and go.sum files created by the devcontainer.
    "mounts": [
        "type=bind,source=${localWorkspaceFolder}/container_files/Makefile,target=/src/Makefile",
        "type=bind,source=${localWorkspaceFolder}/container_files/forge.go,target=/src/forge.go",
        "type=bind,source=${localWorkspaceFolder}/container_files/health.go,target=/src/health.go",
        "type=bind,source=${localWorkspaceFolder}/container_files/template.go,target=/src/template.go",
        "type=bind,source=/mnt/docker_volumes/.secrets/woodpecker/webhook_public_key,target=/run/secrets/webhook_public_key,ro",
        "type=bind,source=/mnt/docker_volumes/.secrets/scale_CA.crt,target=/run/secrets/scale_ca,ro",
        "type=bind,source=/mnt/docker_volumes/woodpecker/template_config_provider/templates/,target=/templates/,ro"
    ],

    "containerEnv": {
        "EXTRA_CA_CERT_FILE": "/run/secrets/scale_ca"
    },

    // Use appropriate language extension.
    "customizations": {
        "vscode": {
            "extensions": [
                "golang.Go",
                "shardulm94.trailing-spaces" // For some reason this extension is marked as a "Workspace Extension".
            ]
        }
    },

    // Install debugger.
    "postCreateCommand": "go install -v github.com/go-delve/delve/cmd/dlv@latest",

    // Expose provider port to remote host (NOT to local machine).
    "appPort": "[::]:8000:8000"
}
